const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./suite-DuS1cFjq.js","./iframe-4keGAOXU.js","./preload-helper-PPVm8Dsz.js","./iframe-tvEuZ1CT.css"])))=>i.map(i=>d[i]);
import{_ as C}from"./preload-helper-PPVm8Dsz.js";import{s as J,d as U,a as H}from"./vitest_suite_proxy-9KiR1lGe.js";function Q(t){if(t?.includes("-"))throw new Error("Snapshot key cannot contain dash")}const k=/^[A-Za-z]:\//;function ee(t=""){return t&&t.replace(/\\/g,"/").replace(k,n=>n.toUpperCase())}const te=/^[/\\](?![/\\])|^[/\\]{2}(?!\.)|^[A-Za-z]:[/\\]/;function ne(){return typeof process<"u"&&typeof process.cwd=="function"?process.cwd().replace(/\\/g,"/"):"/"}const E=function(...t){t=t.map(a=>ee(a));let n="",e=!1;for(let a=t.length-1;a>=-1&&!e;a--){const r=a>=0?t[a]:ne();!r||r.length===0||(n=`${r}/${n}`,e=L(r))}return n=ae(n,!e),e&&!L(n)?`/${n}`:n.length>0?n:"."};function ae(t,n){let e="",a=0,r=-1,s=0,c=null;for(let o=0;o<=t.length;++o){if(o<t.length)c=t[o];else{if(c==="/")break;c="/"}if(c==="/"){if(!(r===o-1||s===1))if(s===2){if(e.length<2||a!==2||e[e.length-1]!=="."||e[e.length-2]!=="."){if(e.length>2){const l=e.lastIndexOf("/");l===-1?(e="",a=0):(e=e.slice(0,l),a=e.length-1-e.lastIndexOf("/")),r=o,s=0;continue}else if(e.length>0){e="",a=0,r=o,s=0;continue}}n&&(e+=e.length>0?"/..":"..",a=2)}else e.length>0?e+=`/${t.slice(r+1,o)}`:e=t.slice(r+1,o),a=o-r-1;r=o,s=0}else c==="."&&s!==-1?++s:s=-1}return e}const L=function(t){return te.test(t)};function re(t,n,e,a,r,s={}){const{threshold:c=.1,alpha:o=.1,aaColor:l=[255,255,0],diffColor:f=[255,0,0],includeAA:p,diffColorAlt:w,diffMask:i}=s;if(!v(t)||!v(n)||e&&!v(e))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(t.length!==n.length||e&&e.length!==t.length)throw new Error("Image sizes do not match.");if(t.length!==a*r*4)throw new Error("Image data size does not match width/height.");const d=a*r,h=new Uint32Array(t.buffer,t.byteOffset,d),u=new Uint32Array(n.buffer,n.byteOffset,d);let x=!0;for(let m=0;m<d;m++)if(h[m]!==u[m]){x=!1;break}if(x){if(e&&!i)for(let m=0;m<d;m++)B(t,4*m,o,e);return 0}const T=35215*c*c,[y,b,g]=l,[$,P,M]=f,[N,X,Z]=w||f;let O=0;for(let m=0;m<r;m++)for(let S=0;S<a;S++){const R=m*a+S,I=R*4,D=h[R]===u[R]?0:W(t,n,I,I,!1);if(Math.abs(D)>T){const q=j(t,S,m,a,r,h,u)||j(n,S,m,a,r,u,h);!p&&q?e&&!i&&_(e,I,y,b,g):(e&&(D<0?_(e,I,N,X,Z):_(e,I,$,P,M)),O++)}else e&&!i&&B(t,I,o,e)}return O}function v(t){return ArrayBuffer.isView(t)&&t.BYTES_PER_ELEMENT===1}function j(t,n,e,a,r,s,c){const o=Math.max(n-1,0),l=Math.max(e-1,0),f=Math.min(n+1,a-1),p=Math.min(e+1,r-1),w=e*a+n;let i=n===o||n===f||e===l||e===p?1:0,d=0,h=0,u=0,x=0,T=0,y=0;for(let b=o;b<=f;b++)for(let g=l;g<=p;g++){if(b===n&&g===e)continue;const $=W(t,t,w*4,(g*a+b)*4,!0);if($===0){if(i++,i>2)return!1}else $<d?(d=$,u=b,x=g):$>h&&(h=$,T=b,y=g)}return d===0||h===0?!1:A(s,u,x,a,r)&&A(c,u,x,a,r)||A(s,T,y,a,r)&&A(c,T,y,a,r)}function A(t,n,e,a,r){const s=Math.max(n-1,0),c=Math.max(e-1,0),o=Math.min(n+1,a-1),l=Math.min(e+1,r-1),f=t[e*a+n];let p=n===s||n===o||e===c||e===l?1:0;for(let w=s;w<=o;w++)for(let i=c;i<=l;i++)if(!(w===n&&i===e)&&(p+=+(f===t[i*a+w]),p>2))return!0;return!1}function W(t,n,e,a,r){const s=t[e],c=t[e+1],o=t[e+2],l=t[e+3],f=n[a],p=n[a+1],w=n[a+2],i=n[a+3];let d=s-f,h=c-p,u=o-w;const x=l-i;if(!d&&!h&&!u&&!x)return 0;if(l<255||i<255){const $=48+159*(e%2),P=48+159*((e/1.618033988749895|0)%2),M=48+159*((e/2.618033988749895|0)%2);d=(s*l-f*i-$*x)/255,h=(c*l-p*i-P*x)/255,u=(o*l-w*i-M*x)/255}const T=d*.29889531+h*.58662247+u*.11448223;if(r)return T;const y=d*.59597799-h*.2741761-u*.32180189,b=d*.21147017-h*.52261711+u*.31114694,g=.5053*T*T+.299*y*y+.1957*b*b;return T>0?-g:g}function _(t,n,e,a,r){t[n+0]=e,t[n+1]=a,t[n+2]=r,t[n+3]=255}function B(t,n,e,a){const r=255+(t[n]*.29889531+t[n+1]*.58662247+t[n+2]*.11448223-255)*e*t[n+3]/255;_(a,n,r,r,r)}function se({failureThresholdType:t,width:n,height:e},a){switch(t){case"pixel":return a;case"percent":return a/(n*e)*100;default:throw new Error(`Unsupported failureThresholdType: ${t}`)}}function oe(t,n,e,a,r,s={}){const c=s.comparisonMethod==="ssim"?le(t,n,e,a,r,s.diffOptions):re(t,n,e,a,r,s.diffOptions),o=se({failureThresholdType:s.failureThresholdType??"pixel",width:a,height:r},c);return{pass:o<=(s.failureThreshold??0),diffAmount:o}}function le(t,n,e,a,r,s){const c={data:t,width:a,height:r},o={data:n,width:a,height:r},{ssim_map:l,mssim:f}=J.ssim(c,o,{ssim:"bezkrovny",...s}),p=Math.round((1-f)*a*r),w=new DataView(e.buffer,e.byteOffset);for(let i=0;i!==r;++i)for(let d=0;d!==a;++d){const h=i*a+d,u=4278190080+Math.floor(255*(1-l.data[l.width*Math.round(l.height*i/r)+Math.round(l.width*d/a)]));w.setUint32(h*4,u)}return p}function ce(t,n){const e=Math.max(t.width,n.width),a=Math.max(t.height,n.height);return{width:e,height:a}}function Y(t,n){return t.width===n.width&&t.height===n.height}const ie=({width:t,height:n})=>e=>{if(Y(e,{width:t,height:n}))return e;const a=(c,o)=>o<=e.height&&c<=e.width,r=new Uint8ClampedArray(t*n*4),s=new ImageData(r,t,n,{colorSpace:e.colorSpace});for(let c=0;c<n;c++)for(let o=0;o<t;o++){const l=t*c+o<<2;if(a(o,c)){const f=e.width*c+o<<2;s.data[l]=e.data[f],s.data[l+1]=e.data[f+1],s.data[l+2]=e.data[f+2],s.data[l+3]=e.data[f+3]}else s.data[l]=0,s.data[l+1]=0,s.data[l+2]=0,s.data[l+3]=64}return s};function fe(t,n){if(Y(t,n))return[t,n];const e=ce(t,n),a=ie(e);return[a(t),a(n)]}function V(t){return t?[`failureThreshold: ${t.failureThreshold??0} ${t.failureThresholdType??"pixels"}`,t.timeout?`timeout: ${t.timeout} ms`:"",`comparisonMethod: ${t.comparisonMethod??"pixel"}`,t.diffOptions?`diffOptions: ${JSON.stringify(t.diffOptions)}`:""].filter(Boolean).join(`
                 `):"none"}function F(t){return new Promise((n,e)=>{const a=new Image;a.src=`data:image/png;base64,${t}`,a.onload=()=>{const r=document.createElement("canvas");r.width=a.width,r.height=a.height;const s=r.getContext("2d");s.drawImage(a,0,0),n(s.getImageData(0,0,r.width,r.height))},a.onerror=()=>{e(new Error("Failed to load image"))}})}async function de(t){const n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),new Promise(a=>{n.toBlob(r=>{const s=new FileReader;s.onload=()=>{a(s.result)},s.readAsDataURL(r)})})}async function he(t,n,e,a){a={...e,...a};const r=await F(e.baseline),s=await F(e.result),[c,o]=fe(r,s),{width:l,height:f}=c,p=new ImageData(l,f),{pass:w,diffAmount:i}=oe(c.data,o.data,p.data,l,f,a);if(w){if(a?.expectToFail)throw new Error(U`Snapshot \`${n}\` matched but expected to fail.

							Options:    ${V(a)}
							Diff:       ${a.failureThresholdType==="percent"?`${i}%`:`${i} pixels`}

							Expected:   ${E(e.projectRoot,e.baselinePath)}
							Actual:     ${E(e.projectRoot,e.resultPath)}`);return}if(H.config.snapshotOptions.updateSnapshot==="all"&&!a?.expectToFail){await G(t,E(e.projectRoot,e.baselinePath),s);return}throw await G(t,E(e.projectRoot,e.diffPath),p),new Error(U`Snapshot \`${n}\` mismatched

					${a?.failureThreshold?a?.failureThresholdType==="percent"?`Expected image to match within ${a.failureThreshold}% but was differ by ${i}%.`:`Expected image to match within ${a.failureThreshold} pixels but was differ by ${i} pixels.`:`Expected image to match but was differ by ${a?.failureThresholdType==="percent"?`${i}%`:`${i} pixels`}.`}${r.width!==s.width||r.height!==s.height?`
The image size changed from ${r.width}x${r.height} to ${s.width}x${s.height}.`:""}

					Options:    ${V(a)}

					Expected:   ${E(e.projectRoot,e.baselinePath)}
					Actual:     ${E(e.projectRoot,e.resultPath)}
					Difference: ${E(e.projectRoot,e.diffPath)}`)}async function G(t,n,e){const a=(await de(e)).split(",")[1];return t.writeFile(n,a,{encoding:"base64"})}async function ue(t,n,e){Q(e?.snapshotKey);const a=await t.preparePageImageSnapshotComparison(n,e);if(a)return he(t,n,a,e)}function pe(t){const n=[];let e=t;for(;e?.suite;)n.unshift(e.suite.name.replace(/[^a-z0-9]/gi,"-").toLowerCase()),e=e.suite;return n.push(t.name.replace(/[^a-z0-9]/gi,"-").toLowerCase()),n.join("/")}function we(t){const n=xe();return n?ue(me,pe(n),t):Promise.resolve()}let z,K;globalThis.__vitest_browser__&&(C(()=>import("./context-BboTKG_b.js"),[],import.meta.url).then(t=>{t.page.extend({toMatchImageSnapshot:we}),z=t}),C(()=>import("./suite-DuS1cFjq.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(t=>{K=t}));const Te=new Proxy({},{get(t,n){const e=z?.page?.[n];return n==="toMatchImageSnapshot"&&e===void 0?()=>{}:e}}),me=new Proxy({},{get(t,n){return z?.commands?.[n]}}),xe=()=>K?.getCurrentTest();export{Q as a,he as b,me as c,xe as g,Te as p,pe as t};
