import{e as X}from"./index-CB-nUy61.js";import{s as J,d as U,a as H}from"./vitest_suite_proxy--nAuBBGv.js";import{g as Q,t as k,c as K}from"./has_image_snapshot-CVVGXbVU.js";function ee(e){if(e!=null&&e.includes("-"))throw new Error("Snapshot key cannot contain dash")}function te(e){return typeof e=="string"&&/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)}const ne=/^[A-Za-z]:\//;function re(e=""){return e&&e.replace(/\\/g,"/").replace(ne,n=>n.toUpperCase())}const ae=/^[/\\](?![/\\])|^[/\\]{2}(?!\.)|^[A-Za-z]:[/\\]/;function se(){return typeof process<"u"&&typeof process.cwd=="function"?process.cwd().replace(/\\/g,"/"):"/"}const T=function(...e){e=e.map(r=>re(r));let n="",t=!1;for(let r=e.length-1;r>=-1&&!t;r--){const a=r>=0?e[r]:se();!a||a.length===0||(n=`${a}/${n}`,t=D(a))}return n=oe(n,!t),t&&!D(n)?`/${n}`:n.length>0?n:"."};function oe(e,n){let t="",r=0,a=-1,s=0,c=null;for(let o=0;o<=e.length;++o){if(o<e.length)c=e[o];else{if(c==="/")break;c="/"}if(c==="/"){if(!(a===o-1||s===1))if(s===2){if(t.length<2||r!==2||t[t.length-1]!=="."||t[t.length-2]!=="."){if(t.length>2){const l=t.lastIndexOf("/");l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),a=o,s=0;continue}else if(t.length>0){t="",r=0,a=o,s=0;continue}}n&&(t+=t.length>0?"/..":"..",r=2)}else t.length>0?t+=`/${e.slice(a+1,o)}`:t=e.slice(a+1,o),r=o-a-1;a=o,s=0}else c==="."&&s!==-1?++s:s=-1}return t}const D=function(e){return ae.test(e)};function le(e,n,t,r,a,s={}){const{threshold:c=.1,alpha:o=.1,aaColor:l=[255,255,0],diffColor:i=[255,0,0],includeAA:w,diffColorAlt:m,diffMask:f}=s;if(!v(e)||!v(n)||t&&!v(t))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(e.length!==n.length||t&&t.length!==e.length)throw new Error("Image sizes do not match.");if(e.length!==r*a*4)throw new Error("Image data size does not match width/height.");const d=r*a,h=new Uint32Array(e.buffer,e.byteOffset,d),u=new Uint32Array(n.buffer,n.byteOffset,d);let p=!0;for(let x=0;x<d;x++)if(h[x]!==u[x]){p=!1;break}if(p){if(t&&!f)for(let x=0;x<d;x++)B(e,4*x,o,t);return 0}const $=35215*c*c,[E,S,g]=l,[b,R,C]=i,[W,Y,j]=m||i;let z=0;for(let x=0;x<a;x++)for(let A=0;A<r;A++){const P=x*r+A,I=P*4,O=h[P]===u[P]?0:G(e,n,I,I,!1);if(Math.abs(O)>$){const q=_(e,A,x,r,a,h,u)||_(n,A,x,r,a,u,h);!w&&q?t&&!f&&M(t,I,E,S,g):(t&&(O<0?M(t,I,W,Y,j):M(t,I,b,R,C)),z++)}else t&&!f&&B(e,I,o,t)}return z}function v(e){return ArrayBuffer.isView(e)&&e.BYTES_PER_ELEMENT===1}function _(e,n,t,r,a,s,c){const o=Math.max(n-1,0),l=Math.max(t-1,0),i=Math.min(n+1,r-1),w=Math.min(t+1,a-1),m=t*r+n;let f=n===o||n===i||t===l||t===w?1:0,d=0,h=0,u=0,p=0,$=0,E=0;for(let S=o;S<=i;S++)for(let g=l;g<=w;g++){if(S===n&&g===t)continue;const b=G(e,e,m*4,(g*r+S)*4,!0);if(b===0){if(f++,f>2)return!1}else b<d?(d=b,u=S,p=g):b>h&&(h=b,$=S,E=g)}return d===0||h===0?!1:y(s,u,p,r,a)&&y(c,u,p,r,a)||y(s,$,E,r,a)&&y(c,$,E,r,a)}function y(e,n,t,r,a){const s=Math.max(n-1,0),c=Math.max(t-1,0),o=Math.min(n+1,r-1),l=Math.min(t+1,a-1),i=e[t*r+n];let w=n===s||n===o||t===c||t===l?1:0;for(let m=s;m<=o;m++)for(let f=c;f<=l;f++)if(!(m===n&&f===t)&&(w+=+(i===e[f*r+m]),w>2))return!0;return!1}function G(e,n,t,r,a){const s=e[t],c=e[t+1],o=e[t+2],l=e[t+3],i=n[r],w=n[r+1],m=n[r+2],f=n[r+3];let d=s-i,h=c-w,u=o-m;const p=l-f;if(!d&&!h&&!u&&!p)return 0;if(l<255||f<255){const b=48+159*(t%2),R=48+159*((t/1.618033988749895|0)%2),C=48+159*((t/2.618033988749895|0)%2);d=(s*l-i*f-b*p)/255,h=(c*l-w*f-R*p)/255,u=(o*l-m*f-C*p)/255}const $=d*.29889531+h*.58662247+u*.11448223;if(a)return $;const E=d*.59597799-h*.2741761-u*.32180189,S=d*.21147017-h*.52261711+u*.31114694,g=.5053*$*$+.299*E*E+.1957*S*S;return $>0?-g:g}function M(e,n,t,r,a){e[n+0]=t,e[n+1]=r,e[n+2]=a,e[n+3]=255}function B(e,n,t,r){const a=255+(e[n]*.29889531+e[n+1]*.58662247+e[n+2]*.11448223-255)*t*e[n+3]/255;M(r,n,a,a,a)}function ce({failureThresholdType:e,width:n,height:t},r){switch(e){case"pixel":return r;case"percent":return r/(n*t)*100;default:throw new Error(`Unsupported failureThresholdType: ${e}`)}}function fe(e,n,t,r,a,s={}){const c=s.comparisonMethod==="ssim"?ie(e,n,t,r,a,s.diffOptions):le(e,n,t,r,a,s.diffOptions),o=ce({failureThresholdType:s.failureThresholdType??"pixel",width:r,height:a},c);return{pass:o<=(s.failureThreshold??0),diffAmount:o}}function ie(e,n,t,r,a,s){const c={data:e,width:r,height:a},o={data:n,width:r,height:a},{ssim_map:l,mssim:i}=J.ssim(c,o,{ssim:"bezkrovny",...s}),w=Math.round((1-i)*r*a),m=new DataView(t.buffer,t.byteOffset);for(let f=0;f!==a;++f)for(let d=0;d!==r;++d){const h=f*r+d,u=4278190080+Math.floor(255*(1-l.data[l.width*Math.round(l.height*f/a)+Math.round(l.width*d/r)]));m.setUint32(h*4,u)}return w}function de(e,n){const t=Math.max(e.width,n.width),r=Math.max(e.height,n.height);return{width:t,height:r}}function V(e,n){return e.width===n.width&&e.height===n.height}const he=({width:e,height:n})=>t=>{if(V(t,{width:e,height:n}))return t;const r=(c,o)=>o<=t.height&&c<=t.width,a=new Uint8ClampedArray(e*n*4),s=new ImageData(a,e,n,{colorSpace:t.colorSpace});for(let c=0;c<n;c++)for(let o=0;o<e;o++){const l=e*c+o<<2;if(r(o,c)){const i=t.width*c+o<<2;s.data[l]=t.data[i],s.data[l+1]=t.data[i+1],s.data[l+2]=t.data[i+2],s.data[l+3]=t.data[i+3]}else s.data[l]=0,s.data[l+1]=0,s.data[l+2]=0,s.data[l+3]=64}return s};function ue(e,n){if(V(e,n))return[e,n];const t=de(e,n),r=he(t);return[r(e),r(n)]}function L(e){return e?[`failureThreshold: ${e.failureThreshold??0} ${e.failureThresholdType??"pixels"}`,e.timeout?`timeout: ${e.timeout} ms`:"",`comparisonMethod: ${e.comparisonMethod??"pixel"}`,e.diffOptions?`diffOptions: ${JSON.stringify(e.diffOptions)}`:""].filter(Boolean).join(`
                 `):"none"}function F(e){return new Promise((n,t)=>{const r=new Image;r.src=`data:image/png;base64,${e}`,r.onload=()=>{const a=document.createElement("canvas");a.width=r.width,a.height=r.height;const s=a.getContext("2d");s.drawImage(r,0,0),n(s.getImageData(0,0,a.width,a.height))},r.onerror=()=>{t(new Error("Failed to load image"))}})}async function we(e){const n=document.createElement("canvas");return n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),new Promise(r=>{n.toBlob(a=>{const s=new FileReader;s.onload=()=>{r(s.result)},s.readAsDataURL(a)})})}async function me(e,n,t,r){r={...t,...r};const a=await F(t.baseline),s=await F(t.result),[c,o]=ue(a,s),{width:l,height:i}=c,w=new ImageData(l,i),{pass:m,diffAmount:f}=fe(c.data,o.data,w.data,l,i,r);if(m){if(r!=null&&r.expectToFail)throw new Error(U`Snapshot \`${n}\` matched but expected to fail.

							Options:    ${L(r)}
							Diff:       ${r.failureThresholdType==="percent"?`${f}%`:`${f} pixels`}

							Expected:   ${T(t.projectRoot,t.baselinePath)}
							Actual:     ${T(t.projectRoot,t.resultPath)}`);return}if(H.config.snapshotOptions.updateSnapshot==="all"&&!(r!=null&&r.expectToFail)){await N(e,T(t.projectRoot,t.baselinePath),s);return}throw await N(e,T(t.projectRoot,t.diffPath),w),new Error(U`Snapshot \`${n}\` mismatched

					${r!=null&&r.failureThreshold?(r==null?void 0:r.failureThresholdType)==="percent"?`Expected image to match within ${r.failureThreshold}% but was differ by ${f}%.`:`Expected image to match within ${r.failureThreshold} pixels but was differ by ${f} pixels.`:`Expected image to match but was differ by ${(r==null?void 0:r.failureThresholdType)==="percent"?`${f}%`:`${f} pixels`}.`}${a.width!==s.width||a.height!==s.height?`
The image size changed from ${a.width}x${a.height} to ${s.width}x${s.height}.`:""}

					Options:    ${L(r)}

					Expected:   ${T(t.projectRoot,t.baselinePath)}
					Actual:     ${T(t.projectRoot,t.resultPath)}
					Difference: ${T(t.projectRoot,t.diffPath)}`)}async function N(e,n,t){const r=(await we(t)).split(",")[1];return e.writeFile(n,r,{encoding:"base64"})}function xe(e){if(!e||!(e instanceof Element))throw new Error(`Expected DOM element to be an instance of Element, received ${typeof e}`);return Se(e)}function pe(e){return e.split("").map(n=>{const t=n.charCodeAt(0);return n===" "||n==="#"||n==="."||n===":"||n==="["||n==="]"||n===">"||n==="+"||n==="~"||n==="\\"?`\\${n}`:t>=65536?`\\${t.toString(16).toUpperCase().padStart(6,"0")} `:t<32||t===127?`\\${t.toString(16).toUpperCase().padStart(2,"0")} `:t>=128?`\\${t.toString(16).toUpperCase().padStart(2,"0")} `:n}).join("")}function Se(e){const n=[];let t,r=!1;for(;t=ge(e);){t.shadowRoot&&(r=!0);const a=e.tagName;if(e.id)n.push(`#${pe(e.id)}`);else if(!e.nextElementSibling&&!e.previousElementSibling)n.push(a.toLowerCase());else{let s=0,c=0,o=0;for(const l of t.children)s++,l.tagName===a&&c++,l===e&&(o=s);c>1?n.push(`${a.toLowerCase()}:nth-child(${o})`):n.push(a.toLowerCase())}e=t}return`${$e().provider==="webdriverio"&&r?">>>":""}${n.reverse().join(" > ")}`}function ge(e){const n=e.parentNode;return n instanceof ShadowRoot?n.host:n}function $e(){return window.__vitest_browser_runner__}async function be(e,n,t,r){ee(r==null?void 0:r.snapshotKey);const a=await e.prepareImageSnapshotComparison(n,Ee(t),r);if(a)return me(e,n,a,r)}function Ee(e){if(e instanceof Element)return xe(e);if(e!=null&&e.selector)return e.selector;if(te(e))return e;throw new Error(`'toMatchImageSnapshot()' expects the subject to be an element, locator, or image encoded in base64 string, but got: ${e}`)}const Z={pass:!0,message:()=>""};function Te(e,n){const t=Q();return t?be(K,k(t),e,n).then(()=>Z):Promise.resolve(Z)}X.extend({toMatchImageSnapshot:Te});
